<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>House Details</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
        #emailDiv {
            margin-right: 400px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        #userNameDiv {
            margin-left: 100px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        #commentDiv {
            margin-left: 200px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        #buttonDiv {
            margin-left: 50px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        #comments {
            margin-left: 50px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container d-flex flex-column justify-content-center">
    <div class="d-flex justify-content-between">
        <div>
            <p class="text-info"><strong>House Name</strong></p>
            <h5 th:text="${house.houseName}"></h5>
        </div>
        <div>
            <p class="text-info"><strong>House Number</strong></p>
            <h5 th:text="${house.houseNumber}"></h5>
        </div>
        <div>
            <p class="text-info"><strong>Road Number</strong></p>
            <h5 th:text="${house.roadNumber}"></h5>
        </div>
    </div>
    <div class="d-flex justify-content-center align-items-center">
        <div><a th:href="${house.location}">House Location</a></div>
    </div>
    <div>
        <div>
            <p class="text-info"><strong>Description</strong></p>
            <h6 th:text="${house.description}"></h6>
        </div>
    </div>
</div>

<div>
    <form th:action="@{/add-review}">
        <div class="d-flex justify-content-center">
            <div id="emailDiv">
                <label for="email">Email</label>
                <input type="text" id="email" name="email" placeholder="Email" required>
            </div>
            <div id="userNameDiv">
                <label for="userName">User Name</label>
                <input type="text" id="userName" name="userName" placeholder="Username" required>
            </div>
        </div>
        <div>
            <div id="commentDiv">
                <label for="comment">Comment</label>
                <textarea id="comment" name="comment" placeholder="Comment" required></textarea>
            </div>
            <div id="buttonDiv">
                <button type="button" class="btn btn-primary click" onclick="submitReview()">Submit</button>
            </div>
        </div>
    </form>
</div>

<div>
    <form th:action="@{/get-reviews}">
        <div id="comments">
            <button type="button" class="btn btn-secondary click" onclick="getReviews()">All Comments</button>
            <ul id="reviewList">

            </ul>
        </div>
    </form>
</div>

<script th:inline="javascript">
function submitReview() {
    var email = document.getElementById('email').value;
    var comment = document.getElementById('comment').value;
    var userName = document.getElementById('userName').value;

    addReview(email, comment, userName);
}

function addReview(email, comment, userName) {
    var xhtr = new XMLHttpRequest();
    xhtr.open('POST', '/add-review', true);

    var formData = new FormData();
    formData.append('email', email);
    formData.append('comment', comment);
    formData.append('userName', userName);

    xhtr.onload = function () {
        if (xhtr.status === 200) {
            alert("Review successfully added.");
        } else {
            alert("Failed to add review. Status: " + xhtr.status);
        }
    };

    xhtr.onerror = function () {
        alert("An error occurred during the transaction.");
    };

    xhtr.send(formData);
}

function getReviews() {
    var xhtr = new XMLHttpRequest();
    xhtr.open('POST', '/get-reviews', true);
    xhtr.onload = function () {
    if (xhtr.status === 200) {
        var reviews = JSON.parse(xhtr.responseText);
        var reviewList = document.getElementById('reviewList');
        reviewList.innerText = '';
        for(var i in reviews){
            var review = document.createElement('li');
            var name = document.createElement('p');
            name.innerText = reviews[i].userName;
            review.appendChild(name);
            reviewList.appendChild(review);
            var comment = document.createElement('p');
            comment.innerText = reviews[i].comment;
            review.appendChild(comment);
            reviewList.appendChild(review);
        }
        var reviewList = document.getElementById('reviewList');
        if(reviewList.style.display === 'block'){
            reviewList.style.display = 'none';
        }else{
            reviewList.style.display = 'block';
         }
    } else {
        alert("An error occurred during the transaction.");
        }
    };
    xhtr.send();
}
</script>
</body>
</html>
